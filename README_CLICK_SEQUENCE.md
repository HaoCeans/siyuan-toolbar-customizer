# 模拟点击序列使用说明

## 什么是模拟点击序列？

模拟点击序列是一种自动化功能，可以按照预设的顺序依次点击页面上的多个元素。适合用于执行多步骤的重复性操作。

## 如何配置？

### 1. 创建/编辑按钮

在思源手机端增强设置中：
- 选择"类型"为 **模拟点击序列**
- 在"点击序列（每行一个选择器）"文本框中填写选择器

### 2. 填写选择器

**每行填写一个选择器**，按钮点击后会按从上到下的顺序依次点击这些元素。

#### 🎯 智能匹配模式（推荐）

**可以直接填写简单的标识符**，无需写完整的 CSS 选择器！插件会自动尝试 6 种方式匹配：

```
barSettings        ✅ 自动匹配（推荐）
search            ✅ 自动匹配
复制块引用          ✅ 自动匹配（文本内容）
```

**自动匹配流程：**
1. 尝试通过 `id` 查找 → `#barSettings`
2. 尝试通过 `data-id` 查找 → `[data-id="barSettings"]`
3. 尝试通过 `data-menu-id` 查找 → `[data-menu-id="barSettings"]`
4. 尝试通过 `data-type` 查找 → `[data-type="search"]`
5. 尝试通过 `class` 查找 → `.search`
6. 尝试通过按钮文本内容查找 → 查找包含"复制块引用"文本的按钮

#### 📝 完整 CSS 选择器模式

如果你需要更精确的控制，也可以写完整的 CSS 选择器：

| 选择器类型 | 语法 | 示例 | 说明 |
|-----------|------|------|------|
| ID 选择器 | `#id` | `#barSettings` | 选择 id="barSettings" 的元素 |
| Class 选择器 | `.class` | `.toolbar__item` | 选择 class="toolbar__item" 的元素 |
| 属性选择器 | `[属性="值"]` | `[data-type="settings"]` | 选择带特定属性的元素 |
| 组合选择器 | `父 > 子` | `.toolbar > button` | 选择父元素下的直接子元素 |
| 后代选择器 | `祖先 后代` | `.menu .item` | 选择祖先元素内的所有后代 |
| 伪类选择器 | `:nth-child(n)` | `.menu > div:nth-child(2)` | 选择第 n 个子元素 |

**检测规则：** 如果选择器包含 `#` `.` `[` `>` 或空格，会被识别为完整 CSS 选择器，直接使用；否则使用智能匹配。

### 3. 配置示例

#### 示例 1：打开设置页面（简单模式）✨
```
barSettings
```
**说明**：自动找到设置按钮并点击

#### 示例 2：打开设置并切换标签页（混合模式）✨
```
barSettings
.b3-dialog__content .b3-tab-bar__item:nth-child(2)
```
**说明**：
1. 智能匹配找到设置按钮
2. 用完整选择器找到对话框中的第 2 个标签页

#### 示例 3：新建文档并选择模板（简单模式）✨
```
new
daily-note
```
**说明**：
1. 智能匹配找到新建按钮（通过 data-type="new"）
2. 智能匹配找到日记模板（通过 data-template-id="daily-note"）

#### 示例 4：通过文本内容点击（简单模式）✨
```
barMore
复制块引用
```
**说明**：
1. 打开更多菜单
2. 智能匹配找到文本为"复制块引用"的按钮

#### 示例 5：复杂操作（完整选择器）
```
#barSearch
.search__input
[data-node-id="20240101120000-abcdefg"]
```
**说明**：
1. 点击搜索按钮（ID选择器）
2. 激活搜索输入框（Class选择器）
3. 点击特定文档（属性选择器）

## 如何找到元素的选择器？

### 方法 1：使用浏览器开发者工具（推荐）

1. 按 `F12` 打开开发者工具
2. 点击左上角的"选择元素"图标（或按 `Ctrl+Shift+C`）
3. 点击你想要选择的页面元素
4. 在开发者工具的 Elements 面板中查看元素属性：
   ```html
   <button id="barSettings" data-type="settings">
   ```
5. **推荐做法：**
   - 如果有 `id` 属性 → 直接填写值（不带 `#`）：`barSettings` ✅
   - 如果有 `data-type` 属性 → 直接填写值：`settings` ✅
   - 如果有 `data-id` 属性 → 直接填写值：`menuSearch` ✅
   - 如果只是普通按钮 → 填写按钮文本：`复制块引用` ✅

### 方法 2：查看元素属性（简单快捷）

思源笔记的很多按钮都有标准属性，可以直接使用：

```
barSettings     ✅ 设置按钮
barSearch       ✅ 搜索按钮
barMode         ✅ 外观按钮
barSync         ✅ 同步按钮
barGraph        ✅ 关系图按钮
barOutline      ✅ 大纲按钮
barMore         ✅ 更多按钮
```

### 方法 3：使用常见模式

思源笔记的常见元素选择器：

```css
/* 顶部工具栏按钮（简单模式）*/
barSettings                    /* 设置按钮 */
barSearch                      /* 搜索按钮 */

/* 菜单项（完整选择器）*/
.b3-menu__item                 /* 所有菜单项 */
.b3-menu__item:nth-child(n)    /* 第 n 个菜单项 */

/* 对话框和面板（完整选择器）*/
.b3-dialog                     /* 对话框容器 */
.b3-dialog__header             /* 对话框标题 */
.b3-dialog__body               /* 对话框内容 */

/* 标签页（完整选择器）*/
.b3-tab-bar__item              /* 标签页项 */
.b3-tab-bar__item:nth-child(n) /* 第 n 个标签 */

/* 输入框和按钮（完整选择器）*/
.b3-text-field                 /* 文本输入框 */
.b3-button                     /* 按钮 */
```

## 高级功能

### 自动等待元素出现

插件会智能等待每个元素出现（最多 5 秒）：
- 如果元素立即可用，会立即点击
- 如果元素暂时不可见（如动画中），会等待其出现
- 如果 5 秒内未出现，会报错并停止

### 自动重试

每个步骤失败后会自动重试 2 次：
- 第 1 次失败：等待 300ms 后重试
- 第 2 次失败：再等待 300ms 后重试
- 第 3 次失败：显示错误提示并停止整个序列

### 步骤间延迟

每个步骤成功后会自动等待 200ms，让界面有时间响应和渲染。

## 常见问题

### Q: 简单模式和完整选择器模式有什么区别？
**A**: 
- **简单模式**：直接填写 `barSettings` 或 `search`，插件自动尝试 6 种方式匹配
- **完整选择器**：填写 `#barSettings` 或 `.toolbar__item`，直接使用 CSS 查询
- **推荐**：优先使用简单模式，更简洁且容错性高

### Q: 什么时候用简单模式，什么时候用完整选择器？
**A**: 
- **简单模式适用**：顶部工具栏按钮、菜单项、有固定属性的元素
- **完整选择器适用**：需要精确定位、多层嵌套、第 N 个子元素
- **混合使用**：可以在同一配置中混用两种模式

### Q: 为什么我的选择器不工作？
**A**: 
1. 简单模式：检查值是否正确（如 `barSettings` 而不是 `#barSettings`）
2. 完整选择器：使用开发者工具确认选择器语法
3. 确认元素是否在 DOM 中（某些元素可能是动态加载的）
4. 查看控制台（F12）的错误信息

### Q: 执行到一半就停止了？
**A**: 
1. 查看控制台（F12）的错误信息
2. 检查失败步骤的选择器是否正确
3. 确认前一步操作是否成功触发了界面变化
4. 可能需要在步骤间增加一个中间步骤

### Q: 如何测试我的选择器？
**A**: 在浏览器控制台中测试：
```javascript
// 测试简单标识符（插件会自动尝试多种方式）
// 手动测试各种方式：
document.getElementById('barSettings')           // 方式1
document.querySelector('[data-id="barSettings"]') // 方式2
document.querySelector('[data-type="search"]')    // 方式4

// 测试完整 CSS 选择器
document.querySelector('#barSettings')
document.querySelector('.toolbar__item')

// 如果返回元素对象，说明选择器正确
// 如果返回 null，说明选择器有误或元素不存在
```

### Q: 可以填写多少个步骤？
**A**: 理论上没有限制，但建议控制在 10 步以内，太多步骤可能不稳定。

## 对比：简单模式 vs 完整选择器

| 特性 | 简单模式 | 完整选择器 |
|------|---------|-----------|
| 语法 | `barSettings` | `#barSettings` |
| 匹配方式 | 智能匹配 6 种 | 标准 CSS 查询 |
| 容错性 | 高（自动尝试多种方式）| 低（必须精确）|
| 适用场景 | 工具栏、菜单、标准按钮 | 复杂嵌套、精确定位 |
| 推荐度 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |

## 提示

1. **优先使用简单模式**：更简洁、更不容易出错
2. **从简单开始**：先配置 2-3 步的简单操作，测试成功后再增加步骤
3. **混合使用**：简单步骤用简单模式，复杂步骤用完整选择器
4. **查看控制台日志**：执行时打开控制台（F12），可以看到每步的执行情况
5. **备份配置**：复杂的配置成功后，建议记录下来，方便后续参考

## 技术原理

```
用户点击按钮
    ↓
读取点击序列配置
    ↓
遍历每个选择器
    ↓
检测是简单模式还是完整选择器
    ↓
简单模式：尝试6种匹配方式 / 完整选择器：直接CSS查询
    ↓
等待元素出现（最多5秒）
    ↓
检查元素是否可见
    ↓
执行点击操作
    ↓
等待200ms
    ↓
继续下一个选择器
    ↓
全部完成 / 出错停止
```

---

**Happy Automating! 🚀**
