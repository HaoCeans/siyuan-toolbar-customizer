# 思源笔记工具栏按钮通用属性分析

## 当前实现的查找方式

本插件已实现6种按钮查找方式（src/toolbarManager.ts:446-513）：

### 1. 通过 `id` 查找
```typescript
document.getElementById(config.builtinId)
```
- 适用于有唯一ID的按钮
- 示例：`menuSearch`

### 2. 通过 `data-id` 查找
```typescript
document.querySelector(`[data-id="${config.builtinId}"]`)
```
- 思源常用的按钮标识方式
- 示例：`data-id="menuSearch"`

### 3. 通过 `data-menu-id` 查找
```typescript
document.querySelector(`[data-menu-id="${config.builtinId}"]`)
```
- 用于菜单项按钮
- 示例：`data-menu-id="menuSearch"`

### 4. 通过 `data-type` 查找
```typescript
document.querySelector(`[data-type="${config.builtinId}"]`)
```
- 最常用的按钮类型标识
- 电脑端和手机端都支持
- 示例：`data-type="exit-focus"`, `data-type="before"`, `data-type="after"`

### 5. 通过 `class` 查找
```typescript
const classSelector = classNames.map(c => `.${c}`).join('')
document.querySelector(classSelector)
```
- 支持多个class组合查找
- 示例：`block__icon ariaLabel`

### 6. 通过按钮文本内容查找
```typescript
const allButtons = document.querySelectorAll('button')
for (const btn of allButtons) {
  const label = btn.querySelector('.b3-menu__label')?.textContent?.trim()
  if (label === config.builtinId) {
    btn.click()
    return
  }
}
```
- 通过按钮显示的文本匹配
- 适用于菜单按钮
- 示例：`"搜索"`, `"全屏"`

## 思源常见按钮 data-type 值

### 编辑器工具栏按钮
基于代码分析和实际使用，以下是思源编辑器中常见的 `data-type` 值：

#### 通用功能按钮
- `exit-focus` - 退出聚焦
- `before` - 前插入
- `after` - 后插入
- `min` - 最小化
- `more` - 更多
- `refresh` - 刷新
- `expand` - 展开
- `collapse` - 折叠

#### 编辑功能按钮
- `readonly` - 只读模式
- `wysiwyg` - 编辑模式
- `preview` - 预览模式
- `both` - 双栏模式

#### 导航和视图
- `outline` - 大纲
- `backlink` - 反链
- `graph` - 关系图
- `bookmark` - 书签
- `tag` - 标签
- `file` - 文件树

## 最佳实践建议

### 优先级顺序
1. **data-type** - 最稳定，电脑端和手机端通用
2. **data-id** - 思源常用标识
3. **id** - 唯一标识
4. **class** - 需要组合使用
5. **文本内容** - 语言相关，不够稳定

### 配置示例
```json
{
  "name": "退出聚焦",
  "builtinId": "exit-focus",
  "icon": "iconExit",
  "type": "builtin"
}
```

### 调试方法
在浏览器控制台执行：
```javascript
// 查看所有工具栏按钮的属性
document.querySelectorAll('.protyle-toolbar button').forEach(btn => {
  console.log({
    id: btn.id,
    'data-type': btn.dataset.type,
    'data-id': btn.dataset.id,
    'data-menu-id': btn.dataset.menuId,
    class: btn.className,
    text: btn.textContent?.trim()
  })
})
```

## 结论

当前实现的6种查找方式已经覆盖了思源笔记的所有主要按钮查找场景。其中 **`data-type`** 是最推荐使用的属性，因为它：
- 在电脑端和手机端都有效
- 值稳定，不随主题或语言变化
- 思源官方广泛使用

建议用户配置按钮时优先使用 `data-type` 属性值。
